<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Sahar-Al-Abeer POS</title>
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" sizes="32x32" href="/favicon.svg"> <!-- fallback; SVG scales -->
  <link rel="apple-touch-icon" href="/apple-touch-icon.png"> <!-- optional -->
  <meta name="theme-color" content="#0ea5e9">

  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="stylesheet" href="css/app.css">
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <h1>Sahar-Al-Abeer POS</h1>
      <div class="spacer"></div>
      <div id="who" class="chip">Signed in</div>
      <button id="logoutBtn" class="btn-logout">Logout</button>
    </div>

    <div class="card row" style="gap:10px;align-items:center">
      <!--<button id="btnSeed" class="ghost">Seed 22 products</button>
      <div class="muted">Use once on a fresh DB.</div>
      <div class="spacer"></div>-->
      <button id="btnExport" class="ghost">Export JSON</button>
    </div>

    <!-- KPIs -->
    <div class="kpis">
      <div class="card kpi"><div class="muted">On-hand Stock Value</div><div id="kpiStockVal" class="val">—</div></div>
      <div class="card kpi"><div class="muted">Total Revenue</div><div id="kpiRevenue" class="val">—</div></div>
      <div class="card kpi"><div class="muted">COGS (Moving Avg)</div><div id="kpiCogs" class="val">—</div></div>
      <div class="card kpi"><div class="muted">Gross Profit / Share(÷4)</div><div id="kpiProfit" class="val">—</div><div id="kpiPartner" class="muted">—</div></div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" data-tab="sell">Record Sale</button>
      <button class="tab" data-tab="buy">Record Purchase</button>
      <button class="tab" data-tab="products">Products</button>
      <button class="tab" data-tab="expenses">Expenses</button>
      <button class="tab" data-tab="reports">Reports</button>
    </div>

    <!-- SELL -->
    <section class="card" data-panel="sell">
      <div class="row" style="margin:8px 0">
        <input id="saleSearch" placeholder="Search product (SKU/Name)" style="max-width:320px">
      </div>
      <div class="grid grid-5">
        <div><label>Product</label><select id="saleProduct"></select></div>
        <div><label>Qty</label><input id="saleQty" type="number" min="1" value="1"/></div>
        <div><label>Unit Price (PKR)</label><input id="salePrice" type="number" min="1"/></div>
        <div><label>Line Discount</label><input id="saleDisc" type="number" min="0" value="0"/></div>
        <div style="align-self:end"><button id="addSale">Quick Add</button></div>
      </div>
	  <div class="note" style="margin-top:8px; font-size:14px;">
  On-hand: <b id="onHand">0</b>
  • <button id="btnInvoice" class="ghost">Download last invoice (PDF)</button>
</div>
      <div class="row" style="margin:10px 0">
        <button id="btnAddToCart" class="secondary">Add line to cart</button>
        <div class="spacer"></div>
        <input id="saleHeaderDisc" type="number" min="0" placeholder="Header discount (PKR)" style="max-width:220px">
        <input id="saleCoupon" placeholder="Coupon code" style="max-width:180px">
      </div>
      <div class="card" style="padding:0;margin-top:8px">
        <table><thead><tr><th>SKU</th><th>Product</th><th class="right">Qty</th><th class="right">Unit</th><th class="right">Line Disc</th><th class="right">Line Gross</th><th>Actions</th></tr></thead><tbody id="cartBody"></tbody></table>
      </div>
      <div class="row" style="margin-top:8px">
        <div class="chip">Items: <b id="cartItems">0</b></div>
        <div class="chip">Gross: <b id="cartGross">—</b></div>
        <div class="chip">Header Disc: <b id="cartHdr">—</b></div>
        <div class="chip">Payable: <b id="cartPay">—</b></div>
        <div class="spacer"></div>
        <button id="btnSaveSale">Save Sale (0)</button>
      </div>

      <h3 style="margin-top:16px">Recent Sales</h3>
      <div class="card table-scroll" style="padding:0">
        <table>
          <thead><tr><th>Date</th><th>Product</th><th class="right">Qty</th><th class="right">Unit</th><th class="right">Disc</th><th class="right">Revenue</th><th class="right">Cost@Sale</th><th class="right">Profit</th></tr></thead>
          <tbody id="salesBody"></tbody>
        </table>
      </div>
    </section>

    <!-- BUY -->
    <section class="card" data-panel="buy" style="display:none">
      <div class="row" style="margin:8px 0"><input id="buySearch" placeholder="Search product (SKU/Name)" style="max-width:320px"></div>
      <div class="grid grid-5">
        <div><label>Product</label><select id="buyProduct"></select></div>
        <div><label>Qty</label><input id="buyQty" type="number" min="1" value="10"/></div>
        <div><label>Unit Cost (PKR)</label><input id="buyCost" type="number" min="1"/></div>
        <div><label>Supplier (optional)</label><input id="buySupplier"/></div>
        <div style="align-self:end"><button id="addBuy">Quick Add</button></div>
      </div>
      <div class="row" style="margin:8px 0">
        <button id="btnAddToPO" class="secondary">Add line to bill</button>
        <div class="spacer"></div>
        <button id="btnSavePO">Save Purchase (0)</button>
      </div>
      <div class="card table-wrap" style="padding:0;margin-top:8px">
        <table><thead><tr><th>SKU</th><th>Product</th><th class="right">Qty</th><th class="right">Unit Cost</th><th class="right">Line Total</th><th>Actions</th></tr></thead><tbody id="poBody"></tbody></table>
      </div>

      <h3 style="margin-top:16px">Recent Purchases</h3>
      <div class="card table-scroll" style="padding:0">
        <table><thead><tr><th>Date</th><th>Product</th><th class="right">Qty</th><th class="right">Unit Cost</th><th class="right">Total</th><th>Supplier</th></tr></thead><tbody id="buysBody"></tbody></table>
      </div>
    </section>

    <!-- PRODUCTS -->
    <section class="card" data-panel="products" style="display:none">
      <div class="row" style="margin-bottom:10px">
        <input id="prodSearch" placeholder="Search products" style="max-width:280px">
        <div class="spacer"></div>
        <button id="btnNew">New Product</button>
      </div>
      <div class="card table-scroll" style="padding:0">
        <table><thead><tr><th>SKU</th><th>Name</th><th class="right">Selling</th><th class="right">Purchase</th><th class="right">Avg Cost</th><th class="right">Stock</th></tr></thead><tbody id="prodBody"></tbody></table>
      </div>
    </section>

    <!-- EXPENSES -->
    <section class="card" data-panel="expenses" style="display:none">
      <div class="grid grid-5">
        <div><label>Date</label><input id="exDate" type="date"/></div>
        <div><label>Category</label><select id="exCat"><option>Rent</option><option>Packaging</option><option>Delivery</option><option>Marketing</option><option>Other</option></select></div>
        <div><label>Amount</label><input id="exAmt" type="number" min="1"/></div>
        <div><label>Note</label><input id="exNote"/></div>
        <div style="align-self:end"><button id="addExpense">Add Expense</button></div>
      </div>
      <div class="card table-wrap" style="padding:0;margin-top:12px">
        <table><thead><tr><th>Date</th><th>Category</th><th>Note</th><th class="right">Amount</th></tr></thead><tbody id="exBody"></tbody></table>
      </div>
    </section>

    <!-- REPORTS -->
    <section class="card" data-panel="reports" style="display:none">
      <div class="row" style="margin-bottom:10px">
        <div><label>From</label><input id="rFrom" type="date"/></div>
        <div><label>To</label><input id="rTo" type="date"/></div>
        <div style="align-self:end"><button id="runReports">Run</button></div>
        <div class="spacer"></div>
        <input id="repSearch" placeholder="Search in results" style="max-width:260px">
        <button id="expDaily" class="ghost">Export Daily CSV</button>
        <button id="expProduct" class="ghost">Export Product CSV</button>
      </div>
      <div class="card table-wrap" id="reportArea">
        <h3>Sales Summary</h3>
        <div class="row">
          <div class="chip">Revenue: <b id="rRev">—</b></div>
          <div class="chip">COGS: <b id="rCogs">—</b></div>
          <div class="chip">Gross Profit: <b id="rGp">—</b></div>
          <div class="chip">Orders: <b id="rOrders">—</b></div>
        </div>
        <h3 style="margin-top:12px">Daily Breakdown</h3>
        <div class="card table-wrap" style="padding:0;margin-bottom:10px"><table><thead><tr><th>Date</th><th class="right">Orders</th><th class="right">Qty</th><th class="right">Revenue</th><th class="right">COGS</th><th class="right">GP</th></tr></thead><tbody id="dailyBody"></tbody></table></div>
        <h3>Product Performance</h3>
        <div class="card table-wrap" style="padding:0"><table><thead><tr><th>SKU</th><th>Product</th><th class="right">Qty</th><th class="right">Revenue</th><th class="right">COGS</th><th class="right">Profit</th><th class="right">Margin%</th><th class="right">On-hand</th></tr></thead><tbody id="prodPerfBody"></tbody></table></div>
      </div>
    </section>

    <!-- Product Modal -->
    <div id="prodModal" class="modal-backdrop">
      <div class="modal">
        <header><h3 id="prodModalTitle">New Product</h3><button id="prodClose" class="outline">✕</button></header>
        <div class="body">
          <div class="grid-2">
            <div><label>SKU</label><input id="mSku" placeholder="e.g., SKU-23"/></div>
            <div><label>Name</label><input id="mName" placeholder="Perfume name"/></div>
          </div>
          <div class="grid-2">
            <div><label>Selling Price (PKR)</label><input id="mSell" type="number" min="1"/></div>
            <div><label>Purchase Price (PKR)</label><input id="mBuy" type="number" min="1"/></div>
          </div>
          <div><label>Low-stock threshold</label><input id="mLow" type="number" min="0" value="5"/></div>
          <div class="muted">New product starts with stock 0 & avg cost 0. Stock comes from purchases.</div>
        </div>
        <footer><button id="prodCancel" class="outline">Cancel</button><button id="prodSave">Save</button></footer>
      </div>
    </div>
  </div>

  <!-- App boot -->
  <script type="module" src="js/app.js"></script>
</body>
</html>